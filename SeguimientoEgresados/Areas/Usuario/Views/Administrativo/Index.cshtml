@model Usuario

@{
    ViewBag.Title = "Administrativo";
    int item = (int)(ViewData["SidebarItem"] ?? 1);
}

@* <h3>Bienvenido al sistema @Html.DisplayFor(m => m.Nombre)</h3> *@
<div class="container-fluid p-4" id="main-view">
    <div class="row">
        <div class="col-12 col-md-6 col-lg-4 col-xl-2 mb-3">
            @* @await Html.PartialAsync("SidebarAdministrativo") *@
            <div class="list-group">
                <a href="#" id="inicio" data-url="@Url.Action("General")" class='list-group-item list-group-item-action active' aria-current="true">
                    <i class="fa-regular fa-file-lines mx-2"></i>General
                </a>
                <a href="#" data-url="@Url.Action("Egresados")" class='list-group-item list-group-item-action '>
                    <i class="fa-solid fa-graduation-cap mx-2"></i>Egresados
                </a>
                <a href="#" data-url="@Url.Action("Empleadores")" class='list-group-item list-group-item-action '>
                    <i class="fa-solid fa-briefcase mx-2"></i>Empleadores
                </a>
                <a href="#" data-url="@Url.Action("Empleadores")" class='list-group-item list-group-item-action '>
                    <i class="fa-solid fa-image mx-2"></i>Galería
                </a>
                <a href="#" data-url="@Url.Action("CambiosPassword")" class='list-group-item list-group-item-action '>
                    <i class="fa-solid fa-unlock mx-2"></i>Cambios de contraseña
                </a>
                <a href="#" data-url="@Url.Action("Reportes")" class='list-group-item list-group-item-action '>
                    <i class="fa-solid fa-comment mx-2"></i>Quejas y reportes
                </a>
            </div>
        </div>
        <div class="col-12 col-md-6 col-lg-8 col-xl-10 border rounded p-2 d-flex justify-content-center" id="vista">
        </div>
    </div>
</div>

@section Scripts
{


    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            const vista = document.getElementById('vista');

            let lastItem = document.getElementById("inicio");
            const firtsUrl = lastItem.dataset.url;
            fetch(firtsUrl)
            .then(res => res.text())
            .then(body => {
                vista.innerHTML = body;
            });

            const links = document.getElementsByClassName('list-group-item');

            for(let i = 0; i < links.length; i++){
                links[i].addEventListener('click', (event) => {

                    if(event.target === lastItem)
                        return;

                    event.target.classList.add('active');
                    lastItem.classList.remove('active');
                    lastItem = event.target;

                    const url = event.target.dataset.url;

                    fetch(url)
                    .then(res => res.text())
                    .then(body => {
                        vista.innerHTML = body;
                        updateView();
                    });
                });
            }
        });

        let order = "";
    
        function updateView(){
            //const cont = document.getElementById('contenido');
            const contenidosAcargar = document.getElementsByClassName("to-load");
            
            for (let i = 0; i < contenidosAcargar.length; i++){
                const dataUrl = contenidosAcargar[i].dataset.url;
                
                contenidosAcargar[i].innerHTML = '<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>';
                fetch(dataUrl)
                .then(res => res.text())
                .then(body => {
                    contenidosAcargar[i].innerHTML = body;
                    
                    const buscador = document.getElementById("busqueda");
                    
                    order = "";
                    
                    if(buscador != null){
                        
                        buscador.addEventListener('input', (event) => actualizarTabla(buscador.dataset.tabla, 1, order));
                    }
                });
            }
            
            // const dataUrl = cont.dataset.url;
            //
            // cont.innerHTML = '<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>';
            // fetch(dataUrl)
            // .then(res => res.text())
            // .then(body => {
            //     cont.innerHTML = body;
            //    
            //     document.getElementById("busqueda").addEventListener('input', (event) => actualizar(1, order));
            // });
        }

        function actualizarTabla(idTabla, pagina = 1, ordenTabla = null){
            
            //const orden = "@ViewData["OrdenActual"]";
            const orden = ordenTabla === null ? order : ordenTabla;
            order = orden;
            const busqueda = document.getElementById("busqueda").value;
            const filtroActual = "@ViewData["Busqueda"]";
            
            const cont = document.getElementById(idTabla);
            const action = cont.dataset.url;
            const url = action + "?" + `ordenTabla=${orden}&busqueda=${busqueda}&filtroActual=${filtroActual}&pagina=${pagina}`;
                    
            cont.innerHTML = '<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>';
            fetch(url)
            .then(res => res.text())
            .then(body => {
                cont.innerHTML = body;
            });
        }
    </script>
}